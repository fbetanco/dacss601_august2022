---
title: "Employee Absenteeism"
author: "Felix Betancourt"
desription: "Discovering aspects associated to Absenteeism in a Courier company. Final Project DACSS601"
date: "08/11/2022"
format:
  html:
    toc: true
    code-fold: true
    code-copy: true
    code-tools: true
categories:
  - Final Project
  - challenge1
  - my name
  - Absenteeism
  - ggplot2
---

```{r}

knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```

# Introduction

Absenteeism is one of topics that has an economic impact in the companies. 

Absenteeism takes place when employees do not report to work. Absenteeism can take two forms, authorized or unauthorized. Management is primarily interested in reducing unauthorized absenteeism since it is more likely to cause hardships on employees and guests alike (Abraham Pizam, A. & Thornburg, S. 2000) (2).

As Henkerson and Persson (2004) (1) said, absence from work can have multiple causes, but there is little doubt that the quantitatively most important one is sick leave. 

The data available in this study is related only to the population reported absent in a courier company, therefore we will try to find what might explain the total number of hours absent to work.


# About the Dataset:

The dataset was found in:

https://www.kaggle.com/datasets/tonypriyanka2913/employee-absenteeism

It contain real data from a Courier Company, and it was created to explain the absenteeism.

Variables:

1.	Individual identification (ID)
2.	Reason for absence (ICD).

Absences attested by the International Code of Diseases (ICD) stratified into 21 categories (I to XXI) as follows:

I Certain infectious and parasitic diseases

II Neoplasms

III Diseases of the blood and blood-forming organs and certain disorders involving the immune mechanism

IV Endocrine, nutritional and metabolic diseases

V Mental and behavioural disorders

VI Diseases of the nervous system

VII Diseases of the eye and adnexa

VIII Diseases of the ear and mastoid process

IX Diseases of the circulatory system

X Diseases of the respiratory system

XI Diseases of the digestive system

XII Diseases of the skin and subcutaneous tissue

XIII Diseases of the musculoskeletal system and connective tissue

XIV Diseases of the genitourinary system

XV Pregnancy, childbirth and the puerperium

XVI Certain conditions originating in the perinatal period

XVII Congenital malformations, deformations and chromosomal abnormalities

XVIII Symptoms, signs and abnormal clinical and laboratory findings, not elsewhere classified

XIX Injury, poisoning and certain other consequences of external causes

XX External causes of morbidity and mortality

XXI Factors influencing health status and contact with health services.

And 7 categories without (CID) patient follow-up (22), medical consultation (23), blood donation (24), laboratory examination (25), unjustified absence (26), physiotherapy (27), dental consultation (28).

3.	Month of absence
4.	Day of the week (Monday (2), Tuesday (3), Wednesday (4), Thursday (5), Friday (6))
5.	Seasons (summer (1), autumn (2), winter (3), spring (4))
6.	Transportation expense
7.	Distance from Residence to Work (kilometers)
8.	Service time
9.	Age
10.	Work load Average/day
11.	Hit target
12.	Disciplinary failure (yes=1; no=0)
13.	Education (high school (1), graduate (2), postgraduate (3), master and doctor (4))
14.	Son (number of children)
15.	Social Drinker (yes=1; no=0)
16.	Social smoker (yes=1; no=0)
17.	Pet (number of pet)
18.	Weight
19.	Height
20.	Body mass index
21.	Absenteeism time in hours (target)


## Setting up and Reading the data

Let's load packages and data.

```{r}
# Loading packages

library(dplyr)
library(tidyverse)
library(formattable)
library(ggplot2)

# Setting working directory and loading dataset.

setwd("/Users/fbetancourt/OneDrive - H-E Parts International/Personal/DACSS/Final Project")

courier <- read.csv("Absenteeism_at_work_Project.csv")

```

## Exploring the data and wrangling it

### Let's see the structure of the dataset

```{r}

str(courier)

```


The dataset has 21 variables and 740 observations to explore potential explanations to the absenteeism.

In terms of the type of data we have:

- Nine (9) Categorical variables:

      - "reason_for_absence"
      - "month_of_absence"
      - "day_of_the_week"
      - "seasons"    
      - "disciplinary_failure"  
      - "education"            
      - "social_drinker"    
      - "social_smoker"     
      - "pet"     

      
- Three (3) numeric discrete:

      - "ID"
      - "work_load_average_day" 
      - "hit_target"            
      
- Nine (9) numeric continuous:

      - "transportation_expense" 
      - "distance_to_work"      
      - "service_time"         
      - "age"                 
      - "son"                
      - "weight"            
      - "height"            
      - "bmi"               
      - "absenteeism_time_in_hours"

      
The dataset seems very clean in general, but I will adjust a few things:

1. Variable "work_load_average_day" and "hit_target" are not clear in the description of the file. I rather to eliminate those variables from the dataset

```{r}
courier2 <- select(courier, - c("work_load_average_day", "hit_target"))

```

2. On the other hand weight and height are used to calculate BMI, so I will eliminate also those 2 variables to simplify the dataset.

```{r}
courier2 <- select(courier2, - c("weight", "height"))
```

3. I will re code back to the categories name for a few relevant categorical variables to use it as character in tables, and will create categorical type of variable for Son (number of children). But I'll save it as new variables in case I need to use it as numeric too at some point.

```{r}

courier2 <-courier2%>%
  mutate(Reason = case_when(
        reason_for_absence == 1 ~ "Parasitic",
        reason_for_absence == 2 ~ "Neoplasms",
        reason_for_absence == 3 ~ "Blood and Immune",
        reason_for_absence == 4 ~ "Metabolic",
        reason_for_absence == 5 ~ "Mental",
        reason_for_absence == 6 ~ "Nervous system",
        reason_for_absence == 7 ~ "Eye and Adnexa",
        reason_for_absence == 8 ~ "Ear and Mastoid",
        reason_for_absence == 9 ~ "Circulatory",
        reason_for_absence == 10 ~ "Respiratory",
        reason_for_absence == 11 ~ "Digestive",
        reason_for_absence == 12 ~ "Skin",
        reason_for_absence == 13 ~ "Musculoskeletal",
        reason_for_absence == 14 ~ "Genitourinary",
        reason_for_absence == 15 ~ "Pregnancy",
        reason_for_absence == 16 ~ "Perinatal period",
        reason_for_absence == 17 ~ "Deformations and Chromosomal",
        reason_for_absence == 18 ~ "Laboratory findings",
        reason_for_absence == 19 ~ "Injury, Poisoning",
        reason_for_absence == 20 ~ "External causes and mortality",
        reason_for_absence == 21 ~ "Health status",
        )) %>%
  mutate(Education.Level = case_when(
         education == 1 ~ "High School",
         education == 2 ~ "Bachelor",
         education == 3 ~ "Post-graduate",
         education == 4 ~ "Master or Phd",
         )) %>%
  mutate(Day.of.Week = case_when(
         day_of_the_week == 2 ~ "Monday",
         day_of_the_week == 3 ~ "Tuesday",
         day_of_the_week == 4 ~ "Wednesday",
         day_of_the_week == 5 ~ "Thursday",
         day_of_the_week == 6 ~ "Friday",
         ))%>%
  mutate(Season = case_when(
         seasons == 1 ~ "Summer",
         seasons == 2 ~ "Autunm",
         seasons == 3 ~ "Winter",
         seasons == 4 ~ "Spring",
         ))%>%
  mutate(Disciplined = case_when(
         disciplinary_failure == 1 ~ "Yes",
         disciplinary_failure == 0 ~ "No",
         ))%>%
  mutate(Drinker = case_when(
         social_drinker == 1 ~ "Yes",
         social_drinker == 0 ~ "No",
        ))%>%
  mutate(Children = case_when(
         son == 0 ~ "No Children",
         son == 1 ~ "One",
         son == 2 ~ "Two",
         son == 3 ~ "Three",
         son == 4 ~ "Four",
        ))%>%
  mutate(Smoker = case_when(
         social_smoker == 1 ~ "Yes",
         social_smoker == 0 ~ "No",
         ))

```


### Descriptive statistics

1. Let's summarize Mean, median, and standard deviation for numeric continuous variables, and frequencies for categorical variables. 

```{r}

#Numerical continuous variables (except ID as it is only for identification purposes)

desc_summary1 <- courier2 %>%
  summarise(Transport.Mean = mean(transportation_expense, na.rm=TRUE), Transport_Median = median(transportation_expense, na.rm=TRUE), Transport.SD = sd(transportation_expense, na.rm=TRUE))

desc_summary2 <- courier2 %>%
  summarise(Distance.Mean = mean(distance_to_work, na.rm=TRUE), Distance.Median = median(distance_to_work, na.rm=TRUE), Distance.SD = sd(distance_to_work, na.rm=TRUE))

desc_summary3 <- courier2 %>%
  summarise(Service.Mean = mean(service_time, na.rm=TRUE), Service.Median = median(service_time, na.rm=TRUE), Service.SD = sd(service_time, na.rm=TRUE))

desc_summary4 <- courier2 %>%
summarise(Age.Mean = mean(age, na.rm=TRUE), Age.Median = median(age, na.rm=TRUE), Age.SD = sd(age, na.rm=TRUE))

desc_summary4 <- courier2 %>%
summarise(Son.Mean = mean(son, na.rm=TRUE), Son.Median = median(son, na.rm=TRUE), Son.SD = sd(son, na.rm=TRUE))

desc_summary5 <- courier2 %>%
summarise(Pet.Mean = mean(pet, na.rm=TRUE), Pet.Median = median(pet, na.rm=TRUE), Pet.SD = sd(pet, na.rm=TRUE))

desc_summary6 <- courier2 %>%
summarise(BMI.Mean = mean(bmi, na.rm=TRUE), BMI.Median = median(bmi, na.rm=TRUE), BMI.SD = sd(bmi, na.rm=TRUE))

#Total Hours
desc_summary7 <- courier2 %>%
summarise(Hours.Mean = mean(absenteeism_time_in_hours, na.rm=TRUE), Hours.Median = median(absenteeism_time_in_hours, na.rm=TRUE), Hours.SD = sd(absenteeism_time_in_hours, na.rm=TRUE))

print(desc_summary1)
print(desc_summary2)
print(desc_summary3)
print(desc_summary4)
print(desc_summary5)
print(desc_summary6)
print(desc_summary7)

#(Formattable didn't work well with a lot of columns)

library(janitor) #Using Janitor package to get useful tables with frequency and percentages

# Frequency table for Reason
tabyl(courier2$Reason, sort = T)

# Since about 65% of the cases doesn't have an specific Reason for Absence, let's see the proportions excuding NA
tabyl(courier2$Reason, sort = T, show_na = FALSE)

# Frequency table for Education Level
tabyl(courier2$Education.Level, sort = T)

# Frequency table for Day of the Week
tabyl(courier2$Day.of.Week, sort = T)
#sort(table(courier2$Day.of.Week), decreasing=TRUE)

# Frequency table for Season
tabyl(courier2$Season, sort = T)

# Frequency table for Disciplined or not
tabyl(courier2$Disciplined, sort = T)

# Frequency table for Drinker or not
tabyl(courier2$Drinker, sort = T)

# Frequency table for Smoker or not
tabyl(courier2$Smoker, sort = T)
 
```

I can see that the top 5 reasons for absence with more frequency are:

- Musculoskeletal
- Injury, Poising
- Digestive
- Respiratory
- Lab findings

However it is relevant to note that 65% of the absences does not provide an specific medical reason. So there is still an important number of employees in this company that are absent for unknown reasons. 

Also found interesting that 94% of the employees who reported absent have not been Disciplined; 92% are not Smokers, and 81% holds a High School Degree as higher education level.

It means that those variables may not help too much to explain well the hours absent as they almost do not vary in this dataset.

2. Now let's Summarise basic descriptive for Absenteeism hours grouped by all Categorical variables.




# Let's create a new dataframe with total number of absenteeism hours

```{r}

library(data.table)
dt <- data.table(courier2)
dt2 <- dt[,list(Total.Hours = sum(absenteeism_time_in_hours, na.rm=T), freq = .N), by = c("ID", "Reason", "bmi", "distance_to_work", "age", "service_time", "Season", "Drinker", "Smoker", "Children", "Disciplined", "Day.of.Week", "Education.Level", "transportation_expense")]

# Frequency table for Season
dt2 %>%
tabyl(ID)
  arrange(desc())

```

# Now let's visualize 

```{r}

# Box Plot Reason of Absence

box_plot_crop<-ggplot(data=dt2, aes(Reason,Total.Hours, fill=Reason)) 
box_plot_crop+ geom_boxplot(alpha=0.7, outlier.shape = NA) +
  theme(legend.position = "right") +
  theme (axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  coord_cartesian(ylim =  c(0, 60))+
  labs(title="Box Plot - Total Absenteeism Hours by Reason of Absence",
        x ="Reason of Absence", y = "Total Hours")


# Box Plot Disciplined

box_plot_crop<-ggplot(data=dt2, aes(Disciplined,Total.Hours, fill=Disciplined)) 
box_plot_crop+ geom_boxplot(alpha=0.7, outlier.shape = NA) +
  theme(legend.position = "right") +
  theme (axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  coord_cartesian(ylim =  c(0, 30))+
  labs(title="Box Plot - Total Absenteeism Hours by Disciplined",
        x ="Has been Disciplined?", y = "Total Hours")


# Box Plot Smoker

box_plot_crop<-ggplot(data=dt2, aes(Smoker,Total.Hours, fill=Smoker)) 
box_plot_crop+ geom_boxplot(alpha=0.7, outlier.shape = NA) +
  theme(legend.position = "right") +
  theme (axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  coord_cartesian(ylim =  c(0, 30))+
  labs(title="Box Plot - Total Absenteeism Hours by Smoker",
        x ="Is Smoker?", y = "Total Hours")


# Box Plot - Drinker

box_plot_crop<-ggplot(data=dt2, aes(Drinker,Total.Hours, fill=Drinker)) 
box_plot_crop+ geom_boxplot(alpha=0.7, outlier.shape = NA) +
  theme(legend.position = "right") +
  theme (axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  coord_cartesian(ylim =  c(0, 40))+
  labs(title="Box Plot - Total Absenteeism Hours by Drinker",
        x ="Is Drinker?", y = "Total Hours")


# Box Plot - Day of the week

box_plot_crop<-ggplot(data=dt2, aes(Day.of.Week,Total.Hours, fill=Day.of.Week)) 
box_plot_crop+ geom_boxplot(alpha=0.7, outlier.shape = NA) +
  theme(legend.position = "right") +
  theme (axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  coord_cartesian(ylim =  c(0, 20))+
  labs(title="Box Plot - Total Absenteeism Hours by Day of the Week",
        x ="Day of the Week", y = "Total Hours")

# Box Plot -Season

box_plot_crop<-ggplot(data=dt2, aes(Season,Total.Hours, fill=Season)) 
box_plot_crop+ geom_boxplot(alpha=0.7, outlier.shape = NA) +
  theme(legend.position = "right") +
  theme (axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  coord_cartesian(ylim =  c(0, 20))+
  labs(title="Box Plot - Total Absenteeism Hours by Season",
        x ="Season", y = "Total Hours")

# Box Plot - Education Level

box_plot_crop<-ggplot(data=dt2, aes(Education.Level,Total.Hours, fill=Education.Level)) 
box_plot_crop+ geom_boxplot(alpha=0.7, outlier.shape = NA) +
  theme(legend.position = "right") +
  theme (axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  coord_cartesian(ylim =  c(0, 20))+
  labs(title="Box Plot - Total Absenteeism Hours by Education Level",
        x ="Education Level", y = "Total Hours")

# Box Plot - Children

box_plot_crop<-ggplot(data=dt2, aes(Children,Total.Hours, fill=Children)) 
box_plot_crop+ geom_boxplot(alpha=0.7, outlier.shape = NA) +
  theme(legend.position = "right") +
  theme (axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  coord_cartesian(ylim =  c(0, 30))+
  labs(title="Box Plot - Total Absenteeism Hours by Children",
        x ="How many Children", y = "Total Hours")

```

From these tables and charts, I can see that:

1. In terms of (medical) Reasons of absence, the top 4 in terms of Total Hours are (in order):

- Circulatory
- Skin
- Injury, Poisoning
- Musculoskeletal

2. Seems that having between 3 to 4 children may have some impact on the absence incidence.

3. For the rest of the categorical variables there are not visible differences that can explain Absence.



## Now let's check any relation between Total Hours of Absence and other continuos variables.

### Histogram for Total hours of absenteeism

```{r}

#Absenteesism histogram - saved as ggplot object

hours_hist <- ggplot(dt2, aes(x=Total.Hours)) +
 geom_histogram(binwidth = 2,
                fill='steelblue',
                col='black') +
  labs(title="Histogram - Total Absenteeism Hours",
        x ="Total Hours", y = "Frequency")

hours_hist

```


### Let's use Scatter Plots


```{r}

# Tenure

scatter1 <- ggplot(dt2, aes(service_time,Total.Hours))+
  geom_point()+
  scale_y_continuous(limits=c(0,150))+
  labs(title="Scatter Plot - Total Absenteeism Hours vs Tenure",
        x ="Years of Service", y = "Total Hours")
scatter1

#Age

scatter2 <- ggplot(dt2, aes(age,Total.Hours))+
  geom_point()+
  scale_y_continuous(limits=c(0,100))+
  labs(title="Scatter Plot - Total Absenteeism Hours vs Age",
        x ="Age", y = "Total Hours")
scatter2

#BMI

scatter3 <- ggplot(dt2, aes(bmi,Total.Hours))+
  geom_point()+
  scale_y_continuous(limits=c(0,100))+
  labs(title="Scatter Plot - Total Absenteeism Hours vs BMI",
        x ="Body Mass Index", y = "Total Hours")
scatter3

#Distance to Work 

scatter5 <- ggplot(dt2, aes(distance_to_work,Total.Hours))+
  geom_point()+
  scale_y_continuous(limits=c(0,100))+
  labs(title="Scatter Plot - Total Absenteeism Hours vs Distance to work",
        x ="Distance to work in KM", y = "Total Hours")
scatter5

# Transportation Expenses 

scatter6 <- ggplot(dt2, aes(transportation_expense,Total.Hours))+
  geom_point()+
  scale_y_continuous(limits=c(0,100))+
  labs(title="Scatter Plot - Total Absenteeism Hours vs Transportation Expense",
        x ="Transportation Expense", y = "Total Hours")
scatter6

```

I can't find any relationship between any of the continuous variables and total hours of abcense.

Seems that the most closer impact to absence are some specific type of medical conditions and having 3-4 children also may increase chances to be absent.

Several bibliography related to Absenteeism suggest that Sick leave is the most common reason for being absent. The data here seems that are consistent with this conclusion, as we don't see other variables affecting the absenteeism.

## Final Comments

### What is missing from your final project?

I wish I had other relevant variables in the dataset, like salary/wages, gender. Those 2 variables in particular are very relevant to predict absenteeism according to certain researches around this topic. 

### What do you hope to accomplish between now and submission time?

I need to complement it with theory around absenteeism, and why is it relevant to study in organizational context.

On the other hand, I would like to improve more the tables and maybe think on other possible combination of variables to explore relationships to the total hours of absence.

